<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Sidang Biologi - Cloud Version</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --primary: #059669; --primary-dark: #047857; --bg: #f3f4f6; --white: #ffffff; --text: #1f2937; --sidebar-width: 260px; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg); color: var(--text); overflow: hidden; }

        /* AUTH SCREEN */
        .auth-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: linear-gradient(135deg, var(--primary-dark), var(--primary)); display: flex; justify-content: center; align-items: center; z-index: 999; }
        .auth-box { background: white; padding: 40px; border-radius: 12px; width: 100%; max-width: 400px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .auth-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; outline: none; font-size: 0.9rem; }
        .auth-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: 0.3s; }
        .auth-btn:hover { background: var(--primary-dark); }
        .toggle-link { margin-top: 15px; font-size: 0.85rem; color: #666; cursor: pointer; text-decoration: underline; }

        /* DASHBOARD LAYOUT */
        #dashboard-app { display: none; height: 100vh; width: 100%; }
        .sidebar { width: var(--sidebar-width); background: var(--primary-dark); color: white; padding: 20px; display: flex; flex-direction: column; height: 100%; }
        .brand { font-size: 1.2rem; font-weight: 600; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        .user-info { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .menu-item { padding: 12px 15px; margin-bottom: 8px; cursor: pointer; border-radius: 8px; transition: 0.3s; display: none; align-items: center; gap: 12px; color: rgba(255,255,255,0.9); font-size: 0.9rem; }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.15); color: white; transform: translateX(5px); }
        .logout-container { margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); }
        .btn-logout { width: 100%; padding: 10px; background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 600; }
        
        .main { flex: 1; padding: 30px; overflow-y: auto; background: var(--bg); }
        h2 { margin-bottom: 20px; color: var(--primary-dark); border-bottom: 2px solid var(--primary); padding-bottom: 10px; display: inline-block; }
        .card { background: var(--white); padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* TABLES */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9rem; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f9fafb; color: #374151; font-weight: 600; }
        
        .sub-table { width: 100%; background: #fefefe; border: 1px solid #eee; border-radius: 4px; }
        .sub-table td { padding: 5px 10px; border: none; font-size: 0.85rem; }

        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
        .status-Pending { background: #fef3c7; color: #d97706; }
        .status-Scheduled { background: #d1fae5; color: #059669; }
        .status-Done { background: #dbeafe; color: #1e40af; }
        
        .btn-action { border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px; color: white; font-size: 0.8rem; }
        .btn-edit { background: #2563eb; } 
        .btn-delete { background: #ef4444; }
        .btn-download { background: #8b5cf6; color: white; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; margin-top: 10px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-submit { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: 600; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 12px; width: 500px; max-height: 90vh; overflow-y: auto; }
        .section { display: none; }
        .section.active { display: block; }

        /* PDF TEMPLATE STYLING (KOP SURAT) */
        #pdf-template { position: absolute; left: -9999px; top: 0; width: 210mm; min-height: 297mm; padding: 25mm; background: white; color: black; font-family: 'Times New Roman', Times, serif; }
        .pdf-header-container { display: flex; align-items: center; border-bottom: 4px double black; padding-bottom: 10px; margin-bottom: 25px; }
        .pdf-logo { width: 80px; height: auto; margin-right: 20px; }
        .pdf-header-text { text-align: center; flex: 1; }
        .pdf-header-text h2 { font-size: 16pt; margin: 0; color: black; border: none; padding: 0; }
        .pdf-header-text h3 { font-size: 14pt; margin: 0; }
        .pdf-header-text p { font-size: 9pt; margin: 2px 0; }
        
        .pdf-body { font-size: 12pt; line-height: 1.6; text-align: justify; }
        .pdf-sig-container { margin-top: 50px; display: flex; justify-content: flex-end; }
        .pdf-sig-box { text-align: left; width: 250px; position: relative; }
        .signature-img { width: 130px; height: auto; margin: -15px 0 -15px 10px; display: block; }
    </style>
</head>
<body>

    <div id="pdf-template">
        <div class="pdf-header-container">
            <img class="pdf-logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIj48cGF0aCBmaWxsPSIjMDU5NjY5IiBkPSJNMjU2IDhMMTggOTR2MTIzYzAgMTU0IDEwMiAyOTggMjM4IDM0NCAxMzYtNDYgMjM4LTE5MCAyMzgtMzQ0Vjk0TDI1NiA4em0wIDQwNWMtOTggMC0xNzgtODAtMTc4LTE3OHM4MC0xNzggMTc4LTE3OCAxNzggODAgMTc4IDE3OC04MCAxNzgtMTc4IDE3OHoiLz48L3N2Zz4=">
            <div class="pdf-header-text">
                <h2>UNIVERSITAS WIRALODRA</h2>
                <h3>FAKULTAS KEGURUAN DAN ILMU PENDIDIKAN</h3>
                <h3 style="font-weight: bold;">PROGRAM STUDI PENDIDIKAN BIOLOGI</h3>
                <p>Terakreditasi Baik Sekali LAMDIK Nomor: 194/LAMDIK/Ak/S/1/2023</p>
                <p>Jl. Ir. H. Djuanda Km. 3 Indramayu 45213 Telp. (0234) 271885</p>
                <p>Email: prodibiofkipunwir@gmail.com</p>
            </div>
        </div>
        <div class="pdf-body">
            <p>Nomor : <span id="pdf-nomor">69/N/Bio-FKIP/XII/2025</span></p>
            <p>Perihal : <b>Hasil Sidang Skripsi</b></p>
            <br>
            <p>Yth. Sdr. <b id="pdf-nama-mhs">NAMA MAHASISWA</b></p>
            <p>Peserta Sidang Skripsi</p>
            <p>Program Studi Pendidikan Biologi</p>
            <p>FKIP Unwir</p>
            <br>
            <p>Berdasarkan hasil penilaian Tim Penguji atas penampilan Saudara pada Sidang Skripsi yang telah dilaksanakan, Saudara dinyatakan <b>Lulus</b> dengan nilai <b>(<span id="pdf-grade">A</span>) (<span id="pdf-skor">80.00</span>)</b> pada Program Studi Pendidikan Biologi FKIP Universitas Wiralodra.</p>
            <br>
            <p>Kami ucapkan selamat kepada Saudara yang dinyatakan lulus dan jangan berkecil hati, tetaplah bersemangat bagi Saudara yang dinyatakan tidak lulus.</p>
        </div>
        <div class="pdf-sig-container">
            <div class="pdf-sig-box">
                <p>Indramayu, <span id="pdf-tgl-skrg">23 Desember 2025</span></p>
                <p>Ketua Program Studi,</p>
                <img class="signature-img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAyCAYAAAC99THMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFJ0lEQVR4nO2ba2hcVRSAn/uYzKSpTZM2SdtU06SptmmapE2SpkmbpE2SpkmbpEnSJGmSNEmaJE2SpmmbpE2SpmmbpE2SpkmbpE2SpmmbpE2SpmmbpEnSJGmSNEmaJE2Spkn7n5m7H5u80SbtJGmStEn7nxnbuXOfOfvsvda999oH+Z//I+8fPdrf6A9A8A8g+AcQ/AMI/gEE/wCCfwDBP4DgH0DwDyD4BxD8Awj+AQT/AIJ/AME/gOAfQPAPIPhvC+R94L7W3fR9B63fO+ivfP456K98/jnoL3f+GegXfX4++nOenwP9mOfnQD/u+VnQ3/r8LOivfX4GdG+evwa6O88vhX6u8Xsh7uX3fVwW4vH76U+F6Tsc7O887K887O887K887K887K887K887K887K887K887K887K887O+fL7D96f79E6jD2z/29v/u6f9N8O8O+9/W3v8D6Idn6P8O8K7W3fT9h63fW/v9h53/m+v993X+u+v9N+r9V7v0V7v0L7r0P7L0z7v0D7v0d7t0X7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p0Z7p+D/8vknp2e6O9OdmW7p7kz3/+f/AAU/AH9+5G8TAAAAAElFTkSuQmCC">
                <p><b>Dr. Sugianto, M.Pd.</b></p>
            </div>
        </div>
    </div>

    <script>
        // API KEY & URL HARUS TETAP SAMA SEPERTI SEBELUMNYA
        // ... (Config Firebase) ...

        // ==========================================
        // FUNGSI UNDUH PDF (VERSI FIX KOP & TTD)
        // ==========================================
        async function unduhHasilSidang(data) {
            const { jsPDF } = window.jspdf;
            
            // 1. Masukkan data ke Template
            const totalNilai = (data.nilai.pem1 || 0) + (data.nilai.pem2 || 0) + (data.nilai.p1 || 0) + (data.nilai.p2 || 0) + (data.nilai.p3 || 0);
            const avg = (totalNilai / 5).toFixed(2);
            const grade = getNilaiHuruf(avg);

            document.getElementById('pdf-nama-mhs').innerText = data.nama.toUpperCase();
            document.getElementById('pdf-grade').innerText = grade;
            document.getElementById('pdf-skor').innerText = avg;
            
            const skrg = new Date();
            const bulan = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            document.getElementById('pdf-tgl-skrg').innerText = `${skrg.getDate()} ${bulan[skrg.getMonth()]} ${skrg.getFullYear()}`;

            const element = document.getElementById('pdf-template');
            
            // 2. Proses Capture Menggunakan html2canvas
            // useCORS: true penting agar gambar dari domain lain bisa terbaca
            html2canvas(element, { 
                scale: 3, // Skala tinggi agar hasil PDF tajam (tidak pecah)
                useCORS: true, 
                logging: false,
                allowTaint: true
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(`Hasil_Sidang_${data.npm}.pdf`);
            }).catch(err => {
                alert("Gagal membuat PDF. Pastikan koneksi internet stabil.");
                console.error(err);
            });
        }

        // SISA KODE LAINNYA (handleLogin, renderJadwal, dll) 
        // TETAP SAMA SEPERTI KODE LENGKAP SEBELUMNYA
        // ...
    </script>
</body>
</html>
